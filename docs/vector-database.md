# üîç –í–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (ChromaDB + Sentence-Transformers)

## –ù–∞–≤–∏–≥–∞—Ü–∏—è

- [–ù–∞–∑–∞–¥ –∫ README](../README.md)
- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](./getting-started.md)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](./architecture.md)
- [Knowledge Graph](./knowledge-graph.md)

---

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Å **ChromaDB** –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ –≤—Å–µ–º –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–º SAG v2.0 –¥–∞–Ω–Ω—ã–º. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ —Ç—Ä–µ—Ö —É—Ä–æ–≤–Ω—è—Ö: –¥–æ–∫—É–º–µ–Ω—Ç—ã, –±–ª–æ–∫–∏ –∏ –≥—Ä–∞—Ñ-—Å—É—â–Ω–æ—Å—Ç–∏.

**üöÄ –ù–û–í–û–ï:** –°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Sentence-Transformers** –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç OpenAI API. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- ‚úÖ **–ù–µ—Ç –∑–∞—Ç—Ä–∞—Ç –Ω–∞ API** - –≤—Å–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ
- ‚úÖ **–ù–µ—Ç rate limits** - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ —Å–∫–æ–ª—å–∫–æ —É–≥–æ–¥–Ω–æ —Ç–µ–∫—Å—Ç–æ–≤
- ‚úÖ **–ë—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –æ—Å–æ–±–µ–Ω–Ω–æ –Ω–∞ GPU (–≤ 10-50 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ)
- ‚úÖ **–ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å** - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å fine-tuning –º–æ–¥–µ–ª–µ–π

---

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è**: –î–æ–∫—É–º–µ–Ω—Ç—ã, –±–ª–æ–∫–∏, –≥—Ä–∞—Ñ-—Å—É—â–Ω–æ—Å—Ç–∏ –∏ Knowledge Graph –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
- **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫**: –ü–æ–∏—Å–∫ –ø–æ —Å–º—ã—Å–ª—É, –∞ –Ω–µ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: –ü–æ–∏—Å–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –ø–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º (video_id, block_type, collection_target –∏ –¥—Ä.)
- **–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫**: –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º –∫–æ–ª–ª–µ–∫—Ü–∏—è–º —Å –≤–µ—Å–∞–º–∏
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è**: –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ pipeline
- **üß† Knowledge Graph –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è**: –£–∑–ª—ã –≥—Ä–∞—Ñ–∞ –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º —Å–≤—è–∑–µ–π –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–ª–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–π

### –ö–æ–ª–ª–µ–∫—Ü–∏–∏ ChromaDB

1. **`sag_v2_documents`** - –í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
   - –¢–µ–∫—Å—Ç: `document_title + document_summary`
   - –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ: video_id, main_topics, collection_target, difficulty_level –∏ –¥—Ä.

2. **`sag_v2_blocks`** - –í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –±–ª–æ–∫–æ–≤
   - –¢–µ–∫—Å—Ç: `title + summary + keywords + content`
   - –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ: block_id, start, end, block_type, graph_entities, youtube_link –∏ –¥—Ä.

3. **`sag_v2_graph_entities`** - –í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ-—Å—É—â–Ω–æ—Å—Ç–µ–π
   - –¢–µ–∫—Å—Ç: `entity_name + context` (–∏–∑ –±–ª–æ–∫–æ–≤ –≥–¥–µ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è)
   - –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ: entity_name, video_id, frequency, domain

4. **üß† `knowledge_graph`** - –í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É–∑–ª–æ–≤ Knowledge Graph
   - –¢–µ–∫—Å—Ç: `node_name + description + connections` (—Å–≤—è–∑–∏ —Å –¥—Ä—É–≥–∏–º–∏ —É–∑–ª–∞–º–∏)
   - –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ: node_id, node_name, node_type, video_id, connections_count, source
   - **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å**: –ö–∞–∂–¥—ã–π —É–∑–µ–ª –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç—Å—è —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –µ–≥–æ —Å–≤—è–∑—è—Ö –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–ª–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```powershell
# –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
.\.venv\Scripts\Activate.ps1

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ chromadb (—É–∂–µ –≤ requirements.txt)
pip install chromadb

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Sentence-Transformers
pip install sentence-transformers transformers torch

# –ü—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –º–æ–¥–µ–ª–∏ –æ–Ω–∞ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫–∞—á–∞–Ω–∞ (~1.2 GB –¥–ª—è multilingual-e5-large)
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ config.yaml

```yaml
vector_db:
  db_path: "data/chromadb"
  collection_prefix: "sag_v2"
  auto_index: false  # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ true –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
  index_levels:
    - "documents"
    - "blocks"
    - "graph_entities"
    - "knowledge_graph"
  embedding:
    provider: "sentence-transformers"
    model: "intfloat/multilingual-e5-large"
    dimension: 1024
  batch_size: 100
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

```env
MODEL_EMBEDDING=sentence-transformers
SENTENCE_TRANSFORMERS_MODEL=intfloat/multilingual-e5-large
# SENTENCE_TRANSFORMERS_DEVICE=cuda  # –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è GPU
```

### 4. –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —á–µ—Ä–µ–∑ Pipeline

```powershell
# –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ (—Ñ–ª–∞–≥ --index-to-vector-db)
python pipeline_orchestrator.py --url "https://youtu.be/VIDEO_ID" --config config.yaml --index-to-vector-db

# –ò–ª–∏ –≤–∫–ª—é—á–∏—Ç–µ auto_index: true –≤ config.yaml
```

### 5. –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤

```powershell
# –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö SAG v2.0 —Ñ–∞–π–ª–æ–≤
python scripts/index_existing_files.py --config config.yaml --input-dir data/sag_final

# –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –±–ª–æ–∫–æ–≤
python scripts/index_existing_files.py --levels blocks

# –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º —à–∞–±–ª–æ–Ω–æ–º
python scripts/index_existing_files.py --pattern "*.for_vector.json"
```

### 6. –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫

```powershell
# –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
python scripts/test_vector_search.py --query "—Ç–µ—Å—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç" --type test_embeddings

# –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (–ø–æ –≤—Å–µ–º –∫–æ–ª–ª–µ–∫—Ü–∏—è–º)
python scripts/test_vector_search.py --query "—á—Ç–æ —Ç–∞–∫–æ–µ –Ω–µ–π—Ä–æ—Å—Ç–∞–ª–∫–∏–Ω–≥" --type hybrid --top-k 10

# –ü–æ–∏—Å–∫ –ø–æ –±–ª–æ–∫–∞–º
python scripts/test_vector_search.py --query "–ø—Ä–∏–Ω—è—Ç–∏–µ –∏ –æ—Å–æ–∑–Ω–∞–≤–∞–Ω–∏–µ" --type blocks --top-k 5

# –ü–æ–∏—Å–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
python scripts/test_vector_search.py --query "–º–µ–¥–∏—Ç–∞—Ü–∏—è" --type blocks --filter '{"video_id": "hDtLWJApJDQ"}'
```

---

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

```python
from vector_db import VectorDBManager, EmbeddingService, VectorSearch
import yaml

# –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
with open('config.yaml', 'r') as f:
    config = yaml.safe_load(f)

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
db_manager = VectorDBManager(
    db_path=config['vector_db']['db_path'],
    collection_prefix=config['vector_db']['collection_prefix']
)
embedding_service = EmbeddingService(
    model=config['vector_db']['embedding'].get('model')
)
search = VectorSearch(db_manager, embedding_service)

# –ü–æ–∏—Å–∫ –ø–æ –±–ª–æ–∫–∞–º
results = search.search_blocks(
    query="—á—Ç–æ —Ç–∞–∫–æ–µ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ",
    top_k=5,
    filters={"block_type": "theory"}
)

# –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫
results = search.hybrid_search(
    query="–ø—Ä–∏–Ω—è—Ç–∏–µ –∏ –ª—é–±–æ–≤—å",
    top_k=10
)
```

---

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤**: 1024 (intfloat/multilingual-e5-large)
- **–ú–µ—Ç—Ä–∏–∫–∞**: Cosine similarity
- **–ë–∞—Ç—á-–æ–±—Ä–∞–±–æ—Ç–∫–∞**: –î–æ 100 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∑–∞ —Ä–∞–∑ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
- **–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ**: –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `data/chromadb/`
- **–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç GPU –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω, –∏–Ω–∞—á–µ CPU

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–Ω–∞ CPU):**
- –î–æ–∫—É–º–µ–Ω—Ç (30 –±–ª–æ–∫–æ–≤): ~2-5 —Å–µ–∫—É–Ω–¥
- 180-–º–∏–Ω—É—Ç–Ω–∞—è –ª–µ–∫—Ü–∏—è: ~10-20 —Å–µ–∫—É–Ω–¥
- –ë–∞—Ç—á –∏–∑ 100 —Ç–µ–∫—Å—Ç–æ–≤: ~5-10 —Å–µ–∫—É–Ω–¥

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–Ω–∞ GPU):**
- –î–æ–∫—É–º–µ–Ω—Ç (30 –±–ª–æ–∫–æ–≤): ~0.2-0.5 —Å–µ–∫—É–Ω–¥—ã
- 180-–º–∏–Ω—É—Ç–Ω–∞—è –ª–µ–∫—Ü–∏—è: ~1-2 —Å–µ–∫—É–Ω–¥—ã
- –ë–∞—Ç—á –∏–∑ 100 —Ç–µ–∫—Å—Ç–æ–≤: ~0.5-1 —Å–µ–∫—É–Ω–¥–∞

---

## –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è Knowledge Graph

Knowledge Graph –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é ChromaDB (`knowledge_graph`):

- –ö–∞–∂–¥—ã–π —É–∑–µ–ª –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç—Å—è —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –µ–≥–æ —Å–≤—è–∑–µ–π
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤–∫–ª—é—á–∞—é—Ç —Ç–∏–ø —É–∑–ª–∞, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤—è–∑–µ–π, –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
- –î–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ –≤–º–µ—Å—Ç–µ —Å –¥—Ä—É–≥–∏–º–∏ –∫–æ–ª–ª–µ–∫—Ü–∏—è–º–∏

---

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

**–ü—Ä–æ–±–ª–µ–º–∞**: –ö–æ–ª–ª–µ–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
```powershell
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª—ã –ø—Ä–æ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω—ã
python scripts/index_existing_files.py --config config.yaml
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
```powershell
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É Sentence-Transformers
pip install sentence-transformers transformers torch

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ .env
# SENTENCE_TRANSFORMERS_MODEL=intfloat/multilingual-e5-large
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –ú–µ–¥–ª–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
```powershell
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ GPU –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
# –î–æ–±–∞–≤—å—Ç–µ –≤ .env: SENTENCE_TRANSFORMERS_DEVICE=cuda
```

---

## –ù–∞–≤–∏–≥–∞—Ü–∏—è

- [–ù–∞–∑–∞–¥ –∫ README](../README.md)
- [Knowledge Graph](./knowledge-graph.md)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](./architecture.md)
- [API –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è](./api-integration.md)

