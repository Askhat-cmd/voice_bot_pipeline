# üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

## –ü—Ä–æ–±–ª–µ–º–∞

–ú–µ–¥–ª–µ–Ω–Ω–∞—è –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏–∑-–∑–∞:
- –°–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ (15s)
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞ (1 worker)
- –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API –ª–∏–º–∏—Ç–æ–≤

## –†–µ—à–µ–Ω–∏–µ

### 1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è config.yaml

```yaml
vector_db:
  rate_limiting:
    delay_between_requests: 0.5  # –ë—ã–ª–æ: 15
    max_workers: 3               # –ë—ã–ª–æ: 1
```

### 2. –ë–∞—Ç—á-–æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ vector_indexer.py

–í—Å–µ –º–µ—Ç–æ–¥—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `create_embeddings_batch()` –≤–º–µ—Å—Ç–æ `create_embedding()`:
- `index_blocks()` - –±–∞—Ç—á-–æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –±–ª–æ–∫–æ–≤ –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º
- `index_graph_entities()` - –±–∞—Ç—á-–æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º
- `index_document()` - –æ—Å—Ç–∞–≤–ª–µ–Ω –æ–¥–∏–Ω–æ—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å (–¥–æ–∫—É–º–µ–Ω—Ç –æ–¥–∏–Ω)

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

–î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
- –í `index_sag_file()` - –æ–±—â–µ–µ –≤—Ä–µ–º—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ —Ñ–∞–π–ª–∞
- –í `create_embeddings_batch()` - –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–∞—Ç—á–∞ —Å –≤—ã–≤–æ–¥–æ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|----|----|-----------|
| –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ | 45 —Å–µ–∫—É–Ω–¥ | 0.5 —Å–µ–∫—É–Ω–¥ | **90√ó –±—ã—Å—Ç—Ä–µ–µ** |
| –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ RPM | 4/3000 (0.1%) | 12/3000 (0.4%) | –ë–µ–∑–æ–ø–∞—Å–Ω–æ |
| –≠–ª–µ–º–µ–Ω—Ç–æ–≤/—Å–µ–∫ | 0.7 | 61.5 | **88√ó –±—ã—Å—Ç—Ä–µ–µ** |

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ–Ω–µ–µ 1% –æ—Ç –ª–∏–º–∏—Ç–æ–≤ OpenAI API (Usage Tier 1: 3000 RPM, 1,000,000 TPM)
- –û–≥—Ä–æ–º–Ω—ã–π –∑–∞–ø–∞—Å –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
- –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –±–µ–∑ –æ—à–∏–±–æ–∫ 429
- –ü—Ä–∏ 3000 RPM –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å 50 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ 2 –∑–∞–ø—Ä–æ—Å–∞/—Å–µ–∫

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:

```bash
# –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
.\.venv\Scripts\Activate.ps1

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç
python scripts/test_vectorization_speed.py
```

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–ü–û–°–õ–ï –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏)

```
üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´:
   ‚è±Ô∏è  –û–±—â–µ–µ –≤—Ä–µ–º—è: 0.52 —Å–µ–∫—É–Ω–¥
   ‚ö° –°–∫–æ—Ä–æ—Å—Ç—å: 61.5 —ç–ª–µ–º–µ–Ω—Ç–æ–≤/—Å–µ–∫
   üöÄ –û–¢–õ–ò–ß–ù–û! –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–∞—è (< 2 —Å–µ–∫)
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)

```yaml
vector_db:
  rate_limiting:
    chunk_size: 2048              # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞
    delay_between_requests: 0.5   # –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ (—Å–µ–∫—É–Ω–¥—ã)
    max_workers: 3                # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤
    max_retries: 5                # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫
    retry_delay: 2                # –ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø—Ä–∏ retry
    max_retry_delay: 60           # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –ø—Ä–∏ retry
```

## Troubleshooting

### –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –º–µ–¥–ª–µ–Ω–Ω–æ:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞—Ç—á-–æ–±—Ä–∞–±–æ—Ç–∫—É:**
   ```python
   # –í vector_indexer.py –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
   embeddings = self.embedding_service.create_embeddings_batch(texts)
   # –ê –ù–ï:
   for text in texts:
       embedding = self.embedding_service.create_embedding(text)
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ config.yaml:**
   ```bash
   # –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å delay: 0.5, workers: 3
   cat config.yaml | grep -A 3 "rate_limiting:"
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   ```bash
   # –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ –±–∞—Ç—á-–æ–±—Ä–∞–±–æ—Ç–∫–µ:
   grep "–±–∞—Ç—á-—Ä–µ–∂–∏–º" pipeline.log
   ```

### –ï—Å–ª–∏ –æ—à–∏–±–∫–∏ 429 (Rate Limit):

–£–≤–µ–ª–∏—á—å—Ç–µ `delay_between_requests`:
```yaml
delay_between_requests: 1.0  # –í–º–µ—Å—Ç–æ 0.5
```

### –ï—Å–ª–∏ –æ—à–∏–±–∫–∏ insufficient_quota:

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–ª–∞–Ω—Å –Ω–∞ [platform.openai.com/account/billing](https://platform.openai.com/account/billing)

## –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

### –î–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏–∑ 180-–º–∏–Ω—É—Ç–Ω–æ–π –ª–µ–∫—Ü–∏–∏:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **–ë–ª–æ–∫–æ–≤** | ~30 |
| **–í—Ä–µ–º—è (–î–û)** | ~45 —Å–µ–∫—É–Ω–¥ |
| **–í—Ä–µ–º—è (–ü–û–°–õ–ï)** | ~0.5 —Å–µ–∫—É–Ω–¥—ã |
| **–£—Å–∫–æ—Ä–µ–Ω–∏–µ** | **90√ó –±—ã—Å—Ç—Ä–µ–µ** |
| **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API** | < 1% –ª–∏–º–∏—Ç–æ–≤ |

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è:

- –ú–æ–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å **26 —Ç–∞–∫–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ** –±–µ–∑ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤
- –ì–æ–¥–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞: **—Å–æ—Ç–Ω–∏ —Ç—ã—Å—è—á –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤**
- –°—Ç–æ–∏–º–æ—Å—Ç—å: –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è (–æ–ø–ª–∞—Ç–∞ —Ç–æ–ª—å–∫–æ –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)

## –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

- **2024-12-02**: –ü–µ—Ä–≤–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  - –£–º–µ–Ω—å—à–µ–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ —Å 15s –¥–æ 0.5s
  - –í–∫–ª—é—á–µ–Ω –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º (3 workers)
  - –î–æ–±–∞–≤–ª–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
  - –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç

